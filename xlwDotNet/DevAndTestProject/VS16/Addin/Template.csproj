<Project DefaultTargets="DotNetInterfaceGenerator" Sdk="Microsoft.NET.Sdk">
  <Import Project="$(MSBuildThisFileDirectory)..\..\..\..\xlw.version.props" />
  <PropertyGroup>
    <TargetFrameworks>net6.0</TargetFrameworks>

    <Platforms>x86</Platforms>
    <XLWROOT>$(MSBuildThisFileDirectory)..\..\..\..</XLWROOT>
    <XLWDOTNETDIR>$(XLWROOT)\xlwDotNet</XLWDOTNETDIR>
    <XLWBIN>$(XLWROOT)\xlw\lib</XLWBIN>
  </PropertyGroup>


  <PropertyGroup>
    <cplatform>$(Platform)</cplatform>
    <cplatform Condition=" '$(Platform)' == 'x86' ">Win32</cplatform>
    <gd></gd>
    <gd Condition=" '$(Configuration)' == 'Debug' ">-gd</gd>
    <XLWDOTNETBIN>$(XLWDOTNETDIR)\lib\$(cplatform)\$(Configuration)\$(TargetFramework)</XLWDOTNETBIN>
    <OutputPath>$(Configuration)\$(cplatform)</OutputPath>
    <AssemblyName>$(MSBuildProjectName).NET</AssemblyName>
  </PropertyGroup>


  <ItemGroup>
    <Compile Remove="AutoGeneratedSource\**" />
    <EmbeddedResource Remove="AutoGeneratedSource\**" />
    <None Remove="AutoGeneratedSource\**" />
  </ItemGroup>

  <ItemGroup>
    <Reference Include="xlwDotNet">
      <HintPath>$(XLWDOTNETBIN)\xlwDotNet-vc143-mt$(gd)-$(XLWVersion).dll</HintPath>
    </Reference>
  </ItemGroup>

  <Target Name="DotNetInterfaceGenerator" AfterTargets="Build" Condition=" '$(TargetFramework)' != '' ">
    <Message Importance="high" Text="AFTERBUILD" />
    <Message Importance="high" Text="$(XLWDOTNETBIN)\DotNetInterfaceGenerator.exe $(OutputPath)$(AssemblyName).dll $(MSBuildProjectName) AutoGeneratedSource DLL" />
    <Exec ConsoleToMsBuild="true" Command="$(XLWDOTNETBIN)\DotNetInterfaceGenerator.exe $(OutputPath)$(AssemblyName).dll $(MSBuildProjectName) AutoGeneratedSource DLL"></Exec>
  </Target>


 <Target Name="InterfaceGenerator" AfterTargets="DotNetInterfaceGenerator">
    <Message Importance="high" Text="$(XLWBIN)\InterfaceGenerator.exe AutoGeneratedSource\DLL.h AutoGeneratedSource\xlwXLL.cpp" />
   <MakeDir Directories="AutoGeneratedSource\ag" />
    <Exec ConsoleToMsBuild="true" Command="$(XLWBIN)\InterfaceGenerator.exe AutoGeneratedSource\DLL.h  AutoGeneratedSource\ag\xlwXLL.cpp"></Exec>
  </Target>

 

  <Target Name="BuildXLL" AfterTargets="InterfaceGenerator" Condition=" '$(TargetFramework)' != '' ">
    
    <MSBuild Condition=" '$(TargetFramework)' != 'net472' " 
             Targets="Build" Projects="AutoGeneratedSource\XLL.vcxproj" 
             Properties="BuildConfig=true;XLWVersion=$(XLWVersion);XLLNAME=$(ProjectName);CLRSupport=NetCore;XLWTF=$(TargetFramework);TargetFramework=$(TargetFramework);Platform=$(cplatform);Configuration=$(Configuration)"/>

    
    <MSBuild Condition=" '$(TargetFramework)' == 'net472' " 
             Targets="Build" Projects="AutoGeneratedSource\XLL.vcxproj" 
             Properties="BuildConfig=true;XLWVersion=$(XLWVersion);XLLNAME=$(ProjectName);CLRSupport=true;XLWTF=$(TargetFramework);TargetFrameworkVersion=4.7.2;Platform=$(cplatform);Configuration=$(Configuration)"/>
      
 
  </Target>



</Project>