<Project DefaultTargets="DotNetInterfaceGenerator" Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <!--<TargetFrameworks>net472;net5.0;netcoreapp3.1</TargetFrameworks>-->
    <TargetFrameworks>net472;net5.0;netcoreapp3.1</TargetFrameworks>
    <Platforms>x64;x86</Platforms>
  </PropertyGroup>


  <PropertyGroup>
    <cplatform>$(Platform)</cplatform>
    <cplatform Condition=" '$(Platform)' == 'x86' ">Win32</cplatform>
    <gd></gd>
    <gd Condition=" '$(Configuration)' == 'Debug' ">-gd</gd>
    <ToolDir>$(XLW)\xlwDotNet\lib\$(Configuration)\$(cplatform)\$(TargetFramework)\</ToolDir>
  </PropertyGroup>


  <PropertyGroup>
    <OutputPath>$(Configuration)\$(cplatform)\</OutputPath>
    <OutputPathForTool>$(Configuration)\$(cplatform)\$(TargetFramework)</OutputPathForTool>
    <AssemblyName>$(MSBuildProjectName).NET</AssemblyName>
  </PropertyGroup>

  <ItemGroup>
    <Reference Include="xlwDotNet">
      <HintPath>$(XLW)\xlwDotNet\lib\$(Configuration)\$(cplatform)\$(TargetFramework)\xlwDotNet-vc142-mt$(gd)-6_0_0.dll</HintPath>
    </Reference>
  </ItemGroup>

 
  <Target Name="DotNetInterfaceGenerator" AfterTargets="Build" Condition=" '$(TargetFramework)' != '' ">
    <Message Importance="high" Text="AFTERBUILD" />
    <Message Importance="high" Text="$(ToolDir)DotNetInterfaceGenerator.exe $(OutputPathForTool)\$(MSBuildProjectName).NET.dll $(MSBuildProjectName) AutoGeneratedSource DLL" />
    <Exec ConsoleToMsBuild="true" Command="$(ToolDir)DotNetInterfaceGenerator.exe $(OutputPathForTool)\$(MSBuildProjectName).NET.dll $(MSBuildProjectName) AutoGeneratedSource DLL"></Exec>
  </Target>
  <Target Name="InterfaceGenerator" AfterTargets="DotNetInterfaceGenerator">
    <Message Importance="high" Text="$(XLW)\xlw\lib\InterfaceGenerator.exe AutoGeneratedSource\DLL.h AutoGeneratedSource\xlwXLL.cpp" />
    <Exec ConsoleToMsBuild="true" Command="$(XLW)\xlw\lib\InterfaceGenerator.exe AutoGeneratedSource\DLL.h  AutoGeneratedSource\xlwXLL.cpp"></Exec>
  </Target>

 

  <Target Name="BuildXLL" AfterTargets="InterfaceGenerator" Condition=" '$(TargetFramework)' != '' ">
    <Message Importance="high" Text="Build Config is  : CLRSupport=$(CLRSupport);TargetFramework=$(TF);TargetFrameworkVersion=$(TFV);Platform=$(Platform);Configuration=$(ConfigurationName)" />
    <MSBuild Condition=" '$(TargetFramework)' != 'net472' " Targets="Build" Projects="AutoGeneratedSource\XLL.vcxproj" Properties="XLLNAME=$(ProjectName);CLRSupport=NetCore;XLWTF=$(TargetFramework);TargetFramework=$(TargetFramework);Platform=$(cplatform);Configuration=$(ConfigurationName)"></MSBuild>
    <MSBuild Condition=" '$(TargetFramework)' == 'net472' " Targets="Build" Projects="AutoGeneratedSource\XLL.vcxproj" Properties="XLLNAME=$(ProjectName);CLRSupport=true;XLWTF=$(TargetFramework);TargetFrameworkVersion=4.7.2;Platform=$(cplatform);Configuration=$(ConfigurationName)"></MSBuild>
  </Target>



</Project>